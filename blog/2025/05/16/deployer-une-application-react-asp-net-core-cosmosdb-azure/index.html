<!doctype html>
<html lang="fr" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Déployer une application React + ASP.NET Core + Cosmos DB sur Azure : gestion des environnements et des secrets | Mickaël Céraline</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mickaelcrl.github.io/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure"><meta data-rh="true" property="og:locale" content="fr"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Déployer une application React + ASP.NET Core + Cosmos DB sur Azure : gestion des environnements et des secrets | Mickaël Céraline"><meta data-rh="true" name="description" content="Dans cet article, je partage mon expérience de déploiement de RentCRL sur Azure. Cette application comprend :"><meta data-rh="true" property="og:description" content="Dans cet article, je partage mon expérience de déploiement de RentCRL sur Azure. Cette application comprend :"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-05-16T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/mickaelcrl"><link data-rh="true" rel="icon" href="/test-github-pages/img/favicon.png"><link data-rh="true" rel="canonical" href="https://mickaelcrl.github.io/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure"><link data-rh="true" rel="alternate" href="https://mickaelcrl.github.io/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure" hreflang="fr"><link data-rh="true" rel="alternate" href="https://mickaelcrl.github.io/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://mickaelcrl.github.io/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure","mainEntityOfPage":"https://mickaelcrl.github.io/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure","url":"https://mickaelcrl.github.io/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure","headline":"Déployer une application React + ASP.NET Core + Cosmos DB sur Azure : gestion des environnements et des secrets","name":"Déployer une application React + ASP.NET Core + Cosmos DB sur Azure : gestion des environnements et des secrets","description":"Dans cet article, je partage mon expérience de déploiement de RentCRL sur Azure. Cette application comprend :","datePublished":"2025-05-16T00:00:00.000Z","author":{"@type":"Person","name":"Mickaël Céraline","description":"Développeur Full Stack","url":"https://github.com/mickaelcrl"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://mickaelcrl.github.io/test-github-pages/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/test-github-pages/blog/rss.xml" title="Mickaël Céraline RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/test-github-pages/blog/atom.xml" title="Mickaël Céraline Atom Feed"><link rel="stylesheet" href="/test-github-pages/assets/css/styles.966bae05.css">
<script src="/test-github-pages/assets/js/runtime~main.1bf631f5.js" defer="defer"></script>
<script src="/test-github-pages/assets/js/main.56910b63.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/test-github-pages/img/MC.svg"><div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/test-github-pages/"><div class="navbar__logo"><img src="/test-github-pages/img/MC.svg" alt="Mickaël Céraline Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/test-github-pages/img/MC.svg" alt="Mickaël Céraline Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Mickaël Céraline</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/test-github-pages/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mickaelcrl" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Navigation article de blog récent"><div class="sidebarItemTitle_pO2u margin-bottom--md">Articles récents</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/test-github-pages/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure">Déployer une application React + ASP.NET Core + Cosmos DB sur Azure : gestion des environnements et des secrets</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/test-github-pages/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api">rentcrl-domain-driven-design-minimal-api</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/test-github-pages/blog/2024/03/07/architecture-rentcrl">Architecture de RentCRL</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/test-github-pages/blog/2023/09/30/presentation-rentcrl">Présentation de RentCRL</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">Déployer une application React + ASP.NET Core + Cosmos DB sur Azure : gestion des environnements et des secrets</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-05-16T00:00:00.000Z">16 mai 2025</time> · <!-- -->8 minutes de lecture</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/mickaelcrl" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Mickaël Céraline</span></a></div><small class="authorTitle_nd0D" title="Développeur Full Stack">Développeur Full Stack</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Dans cet article, je partage mon expérience de déploiement de RentCRL sur Azure. Cette application comprend :</p>
<ul>
<li>
<p>une application React</p>
</li>
<li>
<p>une API REST construite avec ASP.NET Core</p>
</li>
<li>
<p>une base de données Azure Cosmos DB</p>
</li>
</ul>
<p>Mon objectif principal est de montrer comment je suis passé de l’environnement local &quot;Development&quot; à l’environnement &quot;Staging&quot; et de rendre RentCRL accessible à tout le monde..</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-développement-en-local">1. Développement en local<a href="#1-développement-en-local" class="hash-link" aria-label="Lien direct vers 1. Développement en local" title="Lien direct vers 1. Développement en local">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-communication-avec-lapi">1.1. Communication avec l’API<a href="#11-communication-avec-lapi" class="hash-link" aria-label="Lien direct vers 1.1. Communication avec l’API" title="Lien direct vers 1.1. Communication avec l’API">​</a></h3>
<p>En local, il est facile de connecter le tout. Le frontend appelle l’API via un <code>fetch</code> avec le token d&#x27;Auth0 sur le bon endpoint. Dans mon cas, l’API permet juste de créer un owner, alors je me rends sur <code>apiBaseUrl/owners</code>, où <code>apiBaseUrl</code> équivaut à <code>http://localhost:5047</code> pour le moment. Au départ, j’enregistre la variable dans un fichier <code>.env</code>, ce qui donne :</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAccessTokenSilently</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#00009f">import</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">meta</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">env</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation constant" style="color:#36acaa">VITE_API_BASE_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/owners</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;POST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Content-Type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Authorization</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">token</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">owner </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-communication-entre-lapplication-et-la-base-de-données">1.2. Communication entre l’application et la base de données<a href="#12-communication-entre-lapplication-et-la-base-de-données" class="hash-link" aria-label="Lien direct vers 1.2. Communication entre l’application et la base de données" title="Lien direct vers 1.2. Communication entre l’application et la base de données">​</a></h3>
<p>Ensuite, l’API récupère les informations puis crée le owner dans la base de données.</p>
<p>Cependant, l’API a besoin d’accepter les politiques de CORS provenant de l’application et de se connecter à la base de données pour effectuer les actions. Je configure cela dans le fichier <code>Program.cs</code>.</p>
<p>Voici le code pour accepter les politiques de CORS :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddCors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddPolicy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token named-parameter punctuation" style="color:#393A34">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MyAllowSpecificOrigins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      policy </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          policy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithOrigins</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AppBaseUrl&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AllowAnyHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AllowAnyMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AllowCredentials</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et voici le code pour se connecter à la base de données :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AddDatabaseConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">WebApplicationBuilder</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IServiceCollection</span><span class="token plain"> services</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;CosmosDB:EndpointUri&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> primaryKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;CosmosDB:PrimaryKey&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> database </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;CosmosDB:DatabaseName&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddSingleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">CosmosDbService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endpoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> database</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>L’API a besoin de paramètres de configuration : le base URL de l’application, l’endpoint de la base de données, la clé primaire et le nom de la base de données.</p>
<p>Dans le fichier <code>appsettings.json</code>, je peux ajouter le base URL de l’application.</p>
<p>Pour la base de données, en lançant l’émulateur de Cosmos DB, je peux récupérer les informations nécessaires et les mettre directement dans le fichier <code>appsettings.json</code> :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CosmosDB&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;EndpointUri&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://localhost:8081&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;PrimaryKey&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;DatabaseName&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RentCRLDatabase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;AppBaseUrl&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://localhost:5173&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>C’est bon, tout est maintenant connecté : l’application peut envoyer une requête à l’API pour créer un owner, l’API peut l’accepter puis se connecter à la base de données et créer le owner.</p>
<p>Maintenant, comment faire pour que la configuration fonctionne également dans le monde réel et comment le faire proprement ?</p>
<p>Voyons comment j’ai procédé.</p>
<p>En local, l’environnement est celui de &quot;Development&quot; : tout tourne sur ma machine. Or, je veux aller en production ou, du moins pour le moment, en &quot;Staging&quot; (pré-prod). C’est-à-dire que je veux rendre l’application accessible à tous, et pour cela, j’ai choisi d’utiliser une solution serverless proposée par Azure : les Container Apps. Ainsi, les trois entités (application, API et Cosmos DB) ne tourneront plus sur ma machine, donc l’environnement change, tout comme les variables de configuration que j’ai mentionnées plus tôt. Voici comment j’ai adapté mes variables en fonction de l’environnement.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-préparation-dazure">2. Préparation d’Azure<a href="#2-préparation-dazure" class="hash-link" aria-label="Lien direct vers 2. Préparation d’Azure" title="Lien direct vers 2. Préparation d’Azure">​</a></h2>
<p>D’abord, je me suis rendu sur Azure et j’ai créé une base de données Cosmos DB : <a href="https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/quickstart-portal" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/quickstart-portal</a></p>
<p>Ensuite, j’ai créé deux Container Apps : un pour faire tourner l’image de mon API et l’autre pour faire tourner l’image de mon application : <a href="https://learn.microsoft.com/en-us/azure/container-apps/quickstart-portal" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/container-apps/quickstart-portal</a></p>
<p>Puis, j’ai créé un Container Registry pour pousser les images de mon application et de mon API, qui seront récupérées par les Container Apps : <a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal?tabs=azure-cli" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal?tabs=azure-cli</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-déploiement-de-lapi-sur-azure">3. Déploiement de l’API sur Azure<a href="#3-déploiement-de-lapi-sur-azure" class="hash-link" aria-label="Lien direct vers 3. Déploiement de l’API sur Azure" title="Lien direct vers 3. Déploiement de l’API sur Azure">​</a></h2>
<p>ASP.NET gère les variables d’environnement automatiquement lors du lancement de l’application. Comme je l’ai montré plus tôt, grâce au fichier <code>appsettings.json</code>, je peux accéder aux variables de configuration. Maintenant, il suffit de séparer les variables qui changent en fonction de l’environnement dans les <code>appsettings</code> correspondants.</p>
<p>Je peux donc créer les fichiers <code>appsettings.Development.json</code> et <code>appsettings.Staging.json</code>.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="data:image/png;base64,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" width="378" height="78" class="img_ev3q"></p>
<p>Je déplace alors le code dans <code>appsettings.Development.json</code> :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CosmosDB&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;EndpointUri&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://localhost:8081&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;PrimaryKey&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;DatabaseName&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RentCRLDatabase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AppBaseUrl&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://localhost:5173&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Puis, dans <code>appsettings.Staging.json</code>, j’ajoute :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;CosmosDB&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;EndpointUri&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;le endpoint uri de ta bd&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;DatabaseName&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RentCRLDatabase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;AppBaseUrl&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;le base url du container app qui tourne sur l&#x27;image de ton app (frontend)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans le <code>appsettings.Staging.json</code>, je ne mets pas la clé primaire car elle est secrète. J’utilise le Key Vault d’Azure qui me permet de gérer mes secrets, car ceux-ci ne doivent pas être exposés : <a href="https://learn.microsoft.com/en-us/azure/container-apps/manage-secrets?tabs=azure-portal" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/container-apps/manage-secrets?tabs=azure-portal</a></p>
<p>Maintenant, grâce à la variable <code>ASPNETCORE_ENVIRONMENT</code>, si la valeur est &quot;Development&quot;, alors <code>builder.Configuration</code> ira lire dans le fichier <code>appsettings.json</code> puis <code>appsettings.Development.json</code>, et si la valeur est &quot;Staging&quot;, alors il ira lire dans le <code>appsettings.json</code> puis <code>appsettings.Staging.json</code>.</p>
<p>Après avoir créé le Dockerfile et buildé l’image de l’API, au moment de lancer l’image, je passe en paramètre la valeur de la variable d’environnement. Par défaut, dans une image Docker, c’est &quot;Production&quot;.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p 8080:80 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">e ASPNETCORE_ENVIRONMENT=Staging test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Je vérifie que tout fonctionne sur ma machine. Si tout est ok, je pousse l’image dans le Container Registry d’Azure, puis je mets à jour l’image du Container App de l’API.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az containerapp update `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">name </span><span class="token variable" style="color:#36acaa">$containerAppName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">resource-</span><span class="token function" style="color:#d73a49">group</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$resourceGroupName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">image </span><span class="token variable" style="color:#36acaa">$imageName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">cpu 0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">memory 1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">0Gi `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">min-replicas 1 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">max-replicas 2 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token function" style="color:#d73a49">set-env</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">vars `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ASPNETCORE_ENVIRONMENT=Staging `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CosmosDB__PrimaryKey=secretref:cosmosdb-primary-key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Si tu as des erreurs de probes dans ton container app vérifie que ton api expose “/” comme endpoint.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MapGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> Results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;OK&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et que ton image écoute le port 80. Dans le dockerfile : <strong>ENV ASPNETCORE_HTTP_PORTS=80.</strong></p>
<p>L’api fonctionne dans l’environnement de “Development” mais également en “Staging”. Disponible ici : <a href="https://ca-rentcrl-api-stg-fc.politewater-4ee63bcd.francecentral.azurecontainerapps.io/scalar/v1#tag/rentcrlweb" target="_blank" rel="noopener noreferrer">https://ca-rentcrl-api-stg-fc.politewater-4ee63bcd.francecentral.azurecontainerapps.io/scalar/v1#tag/rentcrlweb</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-deploiement-de-lapp-sur-azure">4. Deploiement de l’app sur Azure<a href="#4-deploiement-de-lapp-sur-azure" class="hash-link" aria-label="Lien direct vers 4. Deploiement de l’app sur Azure" title="Lien direct vers 4. Deploiement de l’app sur Azure">​</a></h2>
<p>Pour l’app, j’utilise React, et contrairement à <a href="http://asp.net/" target="_blank" rel="noopener noreferrer">ASP.NET</a>, je n’ai pas trouvé de gestion des variables d’environnement aussi efficace dans React. C’est pourquoi Rémi Céraline (<a href="https://www.remiceraline.com/" target="_blank" rel="noopener noreferrer">https://www.remiceraline.com</a>) m’a montré une approche plutôt intéressante que je vais partager ici.</p>
<p>Mon objectif est que les variables d’environnement puissent changer de valeur <strong>après</strong> le build de l’image, car je veux utiliser la <strong>même image</strong> dans l’environnement de développement, puis dans celui de staging pour les tests, et enfin en production. C’est bien la même image qui passe par ces trois environnements. Pour le moment, la seule variable qui change selon l’environnement est <code>apiBaseUrl</code>, et je veux pouvoir la modifier dans la commande <code>update</code>, comme pour l’API, avec cette commande :</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az containerapp update `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">name </span><span class="token variable" style="color:#36acaa">$containerAppName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">resource-</span><span class="token function" style="color:#d73a49">group</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$resourceGroupName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">image </span><span class="token variable" style="color:#36acaa">$imageName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">cpu 0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">memory 1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">0Gi `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">min-replicas 1 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">max-replicas 2 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token function" style="color:#d73a49">set-env</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">vars `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    API_BASE_URL=https:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">ca-rentcrl-api-stg-</span><span class="token function" style="color:#d73a49">fc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">politewater-4ee63bcd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">francecentral</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">azurecontainerapps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Maintenant dans mon application React, dans le dossier <strong>public</strong>, j’ai créé un dossier <strong>config</strong> dans lequel je cré un fichier env.js et env.template.js.</p>
<p>Dans mon application React, dans le dossier <strong>public</strong>, j’ai créé un dossier <strong>config</strong> dans lequel j’ai mis deux fichiers : <code>env.js</code> et <code>env.template.js</code>.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="data:image/png;base64,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" width="322" height="102" class="img_ev3q"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="envjs">env.js<a href="#envjs" class="hash-link" aria-label="Lien direct vers env.js" title="Lien direct vers env.js">​</a></h3>
<div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> globalConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">apiBaseUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://localhost:5047&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="envtemplatejs">env.template.js<a href="#envtemplatejs" class="hash-link" aria-label="Lien direct vers env.template.js" title="Lien direct vers env.template.js">​</a></h3>
<div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> globalConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">apiBaseUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;${API_BASE_URL}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>J’ai ensuite déclaré cette variable pour l’utiliser dans mon app React, qui fonctionne avec TypeScript. Dans le dossier <strong>src</strong>, j’ai ajouté un fichier <strong>global.d.ts</strong> dans lequel j’ai mis :</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> globalConfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiBaseUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Je remplace alors le code de tout à l’heure par :</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAccessTokenSilently</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">globalConfig</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">apiBaseUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/owners</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;POST&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;Content-Type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Authorization</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">token</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">owner </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="à-quoi-ça-sert-">À quoi ça sert ?<a href="#à-quoi-ça-sert-" class="hash-link" aria-label="Lien direct vers À quoi ça sert ?" title="Lien direct vers À quoi ça sert ?">​</a></h3>
<p>Quand je build mon image, React crée un dossier <strong>dist</strong> qui contient le <strong>bundler</strong> avec tous les fichiers réunis dans un seul gros fichier.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="/test-github-pages/assets/images/image2-6275f67f41230997ea1aba754884f15f.png" width="311" height="228" class="img_ev3q"></p>
<p>À ce moment-là, il est trop tard pour changer la valeur des variables. Il aurait fallu avoir plusieurs fichiers de variables ou une logique conditionnelle pour choisir la bonne en fonction de l’environnement. À défaut, le fichier <strong>global.d.ts</strong> permet à TypeScript de comprendre l’objet <code>globalConfig</code> qui est déclaré dans le dossier <strong>public</strong> — donc <strong>en dehors</strong> du bundler — et qui se trouve dans le dossier <strong>config</strong> après le build.</p>
<p>C’est ce qui me permet de <strong>réécrire sa valeur dans le Dockerfile</strong> avant de lancer l’app grâce à la commande <code>envsubst</code>.</p>
<p>Voici la ligne qui permet de mettre à jour <code>env.template.js</code> :</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  API_BASE_URL=https:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">ca-rentcrl-api-stg-</span><span class="token function" style="color:#d73a49">fc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">politewater-4ee63bcd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">francecentral</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">azurecontainerapps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Puis je remplace le contenu de <code>env.js</code> par celui de <code>env.template.js</code> avec la commande <code>envsubst</code> :</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CMD </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;/bin/sh&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;-c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;envsubst &lt; /usr/share/nginx/html/config/env.template.js &gt; /usr/share/nginx/html/config/env.js &amp;&amp; nginx -g &#x27;daemon off;&#x27;&quot;</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Bien sûr il ne faut pas oublier d’importer la variable dans le <strong>index.html</strong> avant le <strong>main.tsx</strong>.</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">text/javascript</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/config/env.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">root</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">globalConfig</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">module</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/src/main.tsx</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Avec tout ça, je peux mettre à jour le container app et spécifier l’environnement simplement.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Lien direct vers Conclusion" title="Lien direct vers Conclusion">​</a></h2>
<p>En suivant cette approche, j&#x27;ai pu :</p>
<ul>
<li>
<p><strong>Séparer les configurations</strong> selon les environnements, ce qui facilite le déploiement et la maintenance.</p>
</li>
<li>
<p><strong>Sécuriser les secrets</strong> en utilisant Azure Key Vault.</p>
</li>
<li>
<p><strong>Automatiser le déploiement</strong> du frontend et du backend avec Azure Container Apps.</p>
</li>
</ul>
<p>📁 Code source ici : <a href="https://github.com/MickaelCRL/RentCRL" target="_blank" rel="noopener noreferrer">https://github.com/MickaelCRL/RentCRL</a></p>
<p>N&#x27;hésitez pas à me faire part de vos retours ou de vos questions !</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pagination des articles du blog"><a class="pagination-nav__link pagination-nav__link--next" href="/test-github-pages/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api"><div class="pagination-nav__sublabel">Article plus ancien</div><div class="pagination-nav__label">rentcrl-domain-driven-design-minimal-api</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-développement-en-local" class="table-of-contents__link toc-highlight">1. Développement en local</a><ul><li><a href="#11-communication-avec-lapi" class="table-of-contents__link toc-highlight">1.1. Communication avec l’API</a></li><li><a href="#12-communication-entre-lapplication-et-la-base-de-données" class="table-of-contents__link toc-highlight">1.2. Communication entre l’application et la base de données</a></li></ul></li><li><a href="#2-préparation-dazure" class="table-of-contents__link toc-highlight">2. Préparation d’Azure</a></li><li><a href="#3-déploiement-de-lapi-sur-azure" class="table-of-contents__link toc-highlight">3. Déploiement de l’API sur Azure</a></li><li><a href="#4-deploiement-de-lapp-sur-azure" class="table-of-contents__link toc-highlight">4. Deploiement de l’app sur Azure</a><ul><li><a href="#envjs" class="table-of-contents__link toc-highlight">env.js</a></li><li><a href="#envtemplatejs" class="table-of-contents__link toc-highlight">env.template.js</a></li><li><a href="#à-quoi-ça-sert-" class="table-of-contents__link toc-highlight">À quoi ça sert ?</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/mickael-ceraline/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/test-github-pages/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/MickaelCRL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 mickaelceraline.com</div></div></div></footer></div>
</body>
</html>