<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://mickaelceraline.com/blog</id>
    <title>Mickaël Céraline Blog</title>
    <updated>2025-05-16T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://mickaelceraline.com/blog"/>
    <subtitle>Mickaël Céraline Blog</subtitle>
    <icon>https://mickaelceraline.com/img/favicon.png</icon>
    <entry>
        <title type="html"><![CDATA[Déployer une application React + ASP.NET Core + Cosmos DB sur Azure : gestion des environnements et des secrets]]></title>
        <id>https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure</id>
        <link href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure"/>
        <updated>2025-05-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Dans cet article, je partage mon expérience de déploiement de RentCRL sur Azure. Cette application comprend :]]></summary>
        <content type="html"><![CDATA[<p>Dans cet article, je partage mon expérience de déploiement de RentCRL sur Azure. Cette application comprend :</p>
<ul>
<li>
<p>une application React</p>
</li>
<li>
<p>une API REST construite avec ASP.NET Core</p>
</li>
<li>
<p>une base de données Azure Cosmos DB</p>
</li>
</ul>
<p>Mon objectif principal est de montrer comment je suis passé de l’environnement local "Development" à l’environnement "Staging" et de rendre RentCRL accessible à tout le monde..</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-développement-en-local">1. Développement en local<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#1-d%C3%A9veloppement-en-local" class="hash-link" aria-label="Lien direct vers 1. Développement en local" title="Lien direct vers 1. Développement en local">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11-communication-avec-lapi">1.1. Communication avec l’API<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#11-communication-avec-lapi" class="hash-link" aria-label="Lien direct vers 1.1. Communication avec l’API" title="Lien direct vers 1.1. Communication avec l’API">​</a></h3>
<p>En local, il est facile de connecter le tout. Le frontend appelle l’API via un <code>fetch</code> avec le token d'Auth0 sur le bon endpoint. Dans mon cas, l’API permet juste de créer un owner, alors je me rends sur <code>apiBaseUrl/owners</code>, où <code>apiBaseUrl</code> équivaut à <code>http://localhost:5047</code> pour le moment. Au départ, j’enregistre la variable dans un fichier <code>.env</code>, ce qui donne :</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAccessTokenSilently</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation keyword" style="color:#00009f">import</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">meta</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">env</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation constant" style="color:#36acaa">VITE_API_BASE_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/owners</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"POST"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"Content-Type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"application/json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Authorization</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">token</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">owner </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12-communication-entre-lapplication-et-la-base-de-données">1.2. Communication entre l’application et la base de données<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#12-communication-entre-lapplication-et-la-base-de-donn%C3%A9es" class="hash-link" aria-label="Lien direct vers 1.2. Communication entre l’application et la base de données" title="Lien direct vers 1.2. Communication entre l’application et la base de données">​</a></h3>
<p>Ensuite, l’API récupère les informations puis crée le owner dans la base de données.</p>
<p>Cependant, l’API a besoin d’accepter les politiques de CORS provenant de l’application et de se connecter à la base de données pour effectuer les actions. Je configure cela dans le fichier <code>Program.cs</code>.</p>
<p>Voici le code pour accepter les politiques de CORS :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddCors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">options </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddPolicy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token named-parameter punctuation" style="color:#393A34">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MyAllowSpecificOrigins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      policy </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          policy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithOrigins</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"AppBaseUrl"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AllowAnyHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AllowAnyMethod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AllowCredentials</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et voici le code pour se connecter à la base de données :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AddDatabaseConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">WebApplicationBuilder</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IServiceCollection</span><span class="token plain"> services</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"CosmosDB:EndpointUri"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> primaryKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"CosmosDB:PrimaryKey"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> database </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> builder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configuration</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"CosmosDB:DatabaseName"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddSingleton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">CosmosDbService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endpoint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> primaryKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> database</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>L’API a besoin de paramètres de configuration : le base URL de l’application, l’endpoint de la base de données, la clé primaire et le nom de la base de données.</p>
<p>Dans le fichier <code>appsettings.json</code>, je peux ajouter le base URL de l’application.</p>
<p>Pour la base de données, en lançant l’émulateur de Cosmos DB, je peux récupérer les informations nécessaires et les mettre directement dans le fichier <code>appsettings.json</code> :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"CosmosDB"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"EndpointUri"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://localhost:8081"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"PrimaryKey"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw=="</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"DatabaseName"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"RentCRLDatabase"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"AppBaseUrl"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://localhost:5173"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>C’est bon, tout est maintenant connecté : l’application peut envoyer une requête à l’API pour créer un owner, l’API peut l’accepter puis se connecter à la base de données et créer le owner.</p>
<p>Maintenant, comment faire pour que la configuration fonctionne également dans le monde réel et comment le faire proprement ?</p>
<p>Voyons comment j’ai procédé.</p>
<p>En local, l’environnement est celui de "Development" : tout tourne sur ma machine. Or, je veux aller en production ou, du moins pour le moment, en "Staging" (pré-prod). C’est-à-dire que je veux rendre l’application accessible à tous, et pour cela, j’ai choisi d’utiliser une solution serverless proposée par Azure : les Container Apps. Ainsi, les trois entités (application, API et Cosmos DB) ne tourneront plus sur ma machine, donc l’environnement change, tout comme les variables de configuration que j’ai mentionnées plus tôt. Voici comment j’ai adapté mes variables en fonction de l’environnement.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-préparation-dazure">2. Préparation d’Azure<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#2-pr%C3%A9paration-dazure" class="hash-link" aria-label="Lien direct vers 2. Préparation d’Azure" title="Lien direct vers 2. Préparation d’Azure">​</a></h2>
<p>D’abord, je me suis rendu sur Azure et j’ai créé une base de données Cosmos DB : <a href="https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/quickstart-portal" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/cosmos-db/nosql/quickstart-portal</a></p>
<p>Ensuite, j’ai créé deux Container Apps : un pour faire tourner l’image de mon API et l’autre pour faire tourner l’image de mon application : <a href="https://learn.microsoft.com/en-us/azure/container-apps/quickstart-portal" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/container-apps/quickstart-portal</a></p>
<p>Puis, j’ai créé un Container Registry pour pousser les images de mon application et de mon API, qui seront récupérées par les Container Apps : <a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal?tabs=azure-cli" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal?tabs=azure-cli</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-déploiement-de-lapi-sur-azure">3. Déploiement de l’API sur Azure<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#3-d%C3%A9ploiement-de-lapi-sur-azure" class="hash-link" aria-label="Lien direct vers 3. Déploiement de l’API sur Azure" title="Lien direct vers 3. Déploiement de l’API sur Azure">​</a></h2>
<p>ASP.NET gère les variables d’environnement automatiquement lors du lancement de l’application. Comme je l’ai montré plus tôt, grâce au fichier <code>appsettings.json</code>, je peux accéder aux variables de configuration. Maintenant, il suffit de séparer les variables qui changent en fonction de l’environnement dans les <code>appsettings</code> correspondants.</p>
<p>Je peux donc créer les fichiers <code>appsettings.Development.json</code> et <code>appsettings.Staging.json</code>.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="data:image/png;base64,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" width="378" height="78" class="img_ev3q"></p>
<p>Je déplace alors le code dans <code>appsettings.Development.json</code> :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">"CosmosDB"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">"EndpointUri"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://localhost:8081"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">"PrimaryKey"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw=="</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token string" style="color:#e3116c">"DatabaseName"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"RentCRLDatabase"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">"AppBaseUrl"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://localhost:5173"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Puis, dans <code>appsettings.Staging.json</code>, j’ajoute :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"CosmosDB"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"EndpointUri"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"le endpoint uri de ta bd"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"DatabaseName"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"RentCRLDatabase"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">"AppBaseUrl"</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"le base url du container app qui tourne sur l'image de ton app (frontend)"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Dans le <code>appsettings.Staging.json</code>, je ne mets pas la clé primaire car elle est secrète. J’utilise le Key Vault d’Azure qui me permet de gérer mes secrets, car ceux-ci ne doivent pas être exposés : <a href="https://learn.microsoft.com/en-us/azure/container-apps/manage-secrets?tabs=azure-portal" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/en-us/azure/container-apps/manage-secrets?tabs=azure-portal</a></p>
<p>Maintenant, grâce à la variable <code>ASPNETCORE_ENVIRONMENT</code>, si la valeur est "Development", alors <code>builder.Configuration</code> ira lire dans le fichier <code>appsettings.json</code> puis <code>appsettings.Development.json</code>, et si la valeur est "Staging", alors il ira lire dans le <code>appsettings.json</code> puis <code>appsettings.Staging.json</code>.</p>
<p>Après avoir créé le Dockerfile et buildé l’image de l’API, au moment de lancer l’image, je passe en paramètre la valeur de la variable d’environnement. Par défaut, dans une image Docker, c’est "Production".</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">p 8080:80 </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">e ASPNETCORE_ENVIRONMENT=Staging test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Je vérifie que tout fonctionne sur ma machine. Si tout est ok, je pousse l’image dans le Container Registry d’Azure, puis je mets à jour l’image du Container App de l’API.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az containerapp update `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">name </span><span class="token variable" style="color:#36acaa">$containerAppName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">resource-</span><span class="token function" style="color:#d73a49">group</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$resourceGroupName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">image </span><span class="token variable" style="color:#36acaa">$imageName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">cpu 0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">memory 1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">0Gi `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">min-replicas 1 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">max-replicas 2 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token function" style="color:#d73a49">set-env</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">vars `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ASPNETCORE_ENVIRONMENT=Staging `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CosmosDB__PrimaryKey=secretref:cosmosdb-primary-key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Si tu as des erreurs de probes dans ton container app vérifie que ton api expose “/” comme endpoint.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MapGet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> Results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"OK"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Et que ton image écoute le port 80. Dans le dockerfile : <strong>ENV ASPNETCORE_HTTP_PORTS=80.</strong></p>
<p>L’api fonctionne dans l’environnement de “Development” mais également en “Staging”. Disponible ici : <a href="https://ca-rentcrl-api-stg-fc.politewater-4ee63bcd.francecentral.azurecontainerapps.io/scalar/v1#tag/rentcrlweb" target="_blank" rel="noopener noreferrer">https://ca-rentcrl-api-stg-fc.politewater-4ee63bcd.francecentral.azurecontainerapps.io/scalar/v1#tag/rentcrlweb</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-deploiement-de-lapp-sur-azure">4. Deploiement de l’app sur Azure<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#4-deploiement-de-lapp-sur-azure" class="hash-link" aria-label="Lien direct vers 4. Deploiement de l’app sur Azure" title="Lien direct vers 4. Deploiement de l’app sur Azure">​</a></h2>
<p>Pour l’app, j’utilise React, et contrairement à <a href="http://asp.net/" target="_blank" rel="noopener noreferrer">ASP.NET</a>, je n’ai pas trouvé de gestion des variables d’environnement aussi efficace dans React. C’est pourquoi Rémi Céraline (<a href="https://www.remiceraline.com/" target="_blank" rel="noopener noreferrer">https://www.remiceraline.com</a>) m’a montré une approche plutôt intéressante que je vais partager ici.</p>
<p>Mon objectif est que les variables d’environnement puissent changer de valeur <strong>après</strong> le build de l’image, car je veux utiliser la <strong>même image</strong> dans l’environnement de développement, puis dans celui de staging pour les tests, et enfin en production. C’est bien la même image qui passe par ces trois environnements. Pour le moment, la seule variable qui change selon l’environnement est <code>apiBaseUrl</code>, et je veux pouvoir la modifier dans la commande <code>update</code>, comme pour l’API, avec cette commande :</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">az containerapp update `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">name </span><span class="token variable" style="color:#36acaa">$containerAppName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">resource-</span><span class="token function" style="color:#d73a49">group</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$resourceGroupName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">image </span><span class="token variable" style="color:#36acaa">$imageName</span><span class="token plain"> `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">cpu 0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">5 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">memory 1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">0Gi `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">min-replicas 1 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token plain">max-replicas 2 `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">--</span><span class="token function" style="color:#d73a49">set-env</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">vars `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    API_BASE_URL=https:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">ca-rentcrl-api-stg-</span><span class="token function" style="color:#d73a49">fc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">politewater-4ee63bcd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">francecentral</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">azurecontainerapps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Maintenant dans mon application React, dans le dossier <strong>public</strong>, j’ai créé un dossier <strong>config</strong> dans lequel je cré un fichier env.js et env.template.js.</p>
<p>Dans mon application React, dans le dossier <strong>public</strong>, j’ai créé un dossier <strong>config</strong> dans lequel j’ai mis deux fichiers : <code>env.js</code> et <code>env.template.js</code>.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="data:image/png;base64,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" width="322" height="102" class="img_ev3q"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="envjs">env.js<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#envjs" class="hash-link" aria-label="Lien direct vers env.js" title="Lien direct vers env.js">​</a></h3>
<div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> globalConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">apiBaseUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"http://localhost:5047"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="envtemplatejs">env.template.js<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#envtemplatejs" class="hash-link" aria-label="Lien direct vers env.template.js" title="Lien direct vers env.template.js">​</a></h3>
<div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> globalConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">apiBaseUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"${API_BASE_URL}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>J’ai ensuite déclaré cette variable pour l’utiliser dans mon app React, qui fonctionne avec TypeScript. Dans le dossier <strong>src</strong>, j’ai ajouté un fichier <strong>global.d.ts</strong> dans lequel j’ai mis :</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">declare</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> globalConfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiBaseUrl</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Je remplace alors le code de tout à l’heure par :</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAccessTokenSilently</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">globalConfig</span><span class="token template-string interpolation punctuation" style="color:#393A34">.</span><span class="token template-string interpolation">apiBaseUrl</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">/owners</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"POST"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  headers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">"Content-Type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"application/json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">Authorization</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">Bearer </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">token</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  body</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">owner </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="à-quoi-ça-sert-">À quoi ça sert ?<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#%C3%A0-quoi-%C3%A7a-sert-" class="hash-link" aria-label="Lien direct vers À quoi ça sert ?" title="Lien direct vers À quoi ça sert ?">​</a></h3>
<p>Quand je build mon image, React crée un dossier <strong>dist</strong> qui contient le <strong>bundler</strong> avec tous les fichiers réunis dans un seul gros fichier.</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="https://mickaelceraline.com/assets/images/image2-6275f67f41230997ea1aba754884f15f.png" width="311" height="228" class="img_ev3q"></p>
<p>À ce moment-là, il est trop tard pour changer la valeur des variables. Il aurait fallu avoir plusieurs fichiers de variables ou une logique conditionnelle pour choisir la bonne en fonction de l’environnement. À défaut, le fichier <strong>global.d.ts</strong> permet à TypeScript de comprendre l’objet <code>globalConfig</code> qui est déclaré dans le dossier <strong>public</strong> — donc <strong>en dehors</strong> du bundler — et qui se trouve dans le dossier <strong>config</strong> après le build.</p>
<p>C’est ce qui me permet de <strong>réécrire sa valeur dans le Dockerfile</strong> avant de lancer l’app grâce à la commande <code>envsubst</code>.</p>
<p>Voici la ligne qui permet de mettre à jour <code>env.template.js</code> :</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  API_BASE_URL=https:</span><span class="token operator" style="color:#393A34">/</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">ca-rentcrl-api-stg-</span><span class="token function" style="color:#d73a49">fc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">politewater-4ee63bcd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">francecentral</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">azurecontainerapps</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Puis je remplace le contenu de <code>env.js</code> par celui de <code>env.template.js</code> avec la commande <code>envsubst</code> :</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CMD </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"/bin/sh"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"-c"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"envsubst &lt; /usr/share/nginx/html/config/env.template.js &gt; /usr/share/nginx/html/config/env.js &amp;&amp; nginx -g 'daemon off;'"</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Bien sûr il ne faut pas oublier d’importer la variable dans le <strong>index.html</strong> avant le <strong>main.tsx</strong>.</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">text/javascript</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">/config/env.js</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">root</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">globalConfig</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">module</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">/src/main.tsx</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Avec tout ça, je peux mettre à jour le container app et spécifier l’environnement simplement.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conclusion">Conclusion<a href="https://mickaelceraline.com/blog/2025/05/16/deployer-une-application-react-asp-net-core-cosmosdb-azure#conclusion" class="hash-link" aria-label="Lien direct vers Conclusion" title="Lien direct vers Conclusion">​</a></h2>
<p>En suivant cette approche, j'ai pu :</p>
<ul>
<li>
<p><strong>Séparer les configurations</strong> selon les environnements, ce qui facilite le déploiement et la maintenance.</p>
</li>
<li>
<p><strong>Sécuriser les secrets</strong> en utilisant Azure Key Vault.</p>
</li>
<li>
<p><strong>Automatiser le déploiement</strong> du frontend et du backend avec Azure Container Apps.</p>
</li>
</ul>
<p>📁 Code source ici : <a href="https://github.com/MickaelCRL/RentCRL" target="_blank" rel="noopener noreferrer">https://github.com/MickaelCRL/RentCRL</a></p>
<p>N'hésitez pas à me faire part de vos retours ou de vos questions !</p>]]></content>
        <author>
            <name>Mickaël Céraline</name>
            <uri>https://github.com/mickaelcrl</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[rentcrl-domain-driven-design-minimal-api]]></title>
        <id>https://mickaelceraline.com/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api</id>
        <link href="https://mickaelceraline.com/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api"/>
        <updated>2025-04-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Suite du développement de RentCRL : l’application qui permet aux propriétaires d’envoyer automatiquement les quittances de loyer à leurs locataires. Après avoir travaillé sur le frontend en React et l’intégration d’Auth0 pour l’authentification, je me suis attaqué au backend. Je vous partage ici mes choix techniques et leur motivation.]]></summary>
        <content type="html"><![CDATA[<p>Suite du développement de RentCRL : l’application qui permet aux propriétaires d’envoyer automatiquement les quittances de loyer à leurs locataires. Après avoir travaillé sur le frontend en React et l’intégration d’Auth0 pour l’authentification, je me suis attaqué au backend. Je vous partage ici mes choix techniques et leur motivation.</p>
<p>Pour faire simple, nous parlerons de clean architecture, DDD, minimal API, du pattern Result et de FluentValidation.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pourquoi-clean-architecture-et-domain-driven-design-">Pourquoi Clean Architecture et Domain Driven Design ?<a href="https://mickaelceraline.com/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api#pourquoi-clean-architecture-et-domain-driven-design-" class="hash-link" aria-label="Lien direct vers Pourquoi Clean Architecture et Domain Driven Design ?" title="Lien direct vers Pourquoi Clean Architecture et Domain Driven Design ?">​</a></h3>
<p>J’ai choisi de structurer mon backend en suivant les principes de la <strong>Clean Architecture</strong> et du <strong>Domain Driven Design</strong> car ceux-ci sont populaires dans l’industrie et j’avais tout simplement envie de me les approprier et de les découvrir.</p>
<p>Ce n’est pas forcément simple au début, mais ça force à bien séparer les responsabilités :</p>
<ul>
<li>le domaine contient la logique métier</li>
<li>l’application s’occupe de l’orchestration</li>
<li>l’infrastructure gère l’accès aux données</li>
<li>la présentation reçoit les requêtes</li>
</ul>
<p>Voici l’arborescence de la solution :</p>
<p><img decoding="async" loading="lazy" alt="image.png" src="https://mickaelceraline.com/assets/images/image-82e46fda42ac8490b00118d7c8a7a438.png" width="413" height="845" class="img_ev3q"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pourquoi-jai-utilisé-minimal-api-">Pourquoi j’ai utilisé Minimal API ?<a href="https://mickaelceraline.com/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api#pourquoi-jai-utilis%C3%A9-minimal-api-" class="hash-link" aria-label="Lien direct vers Pourquoi j’ai utilisé Minimal API ?" title="Lien direct vers Pourquoi j’ai utilisé Minimal API ?">​</a></h3>
<p>Alors j’ai choisi d’utiliser Minimal API car pendant longtemps il fallait utiliser des contrôleurs mais depuis environ 2 ans .Net a sorti minimal API donc je me suis intéressé a ce que c’est.</p>
<p>De plus, je suis tombé sur une vidéo de Nick Chapsas qui compare minimal API avec MVC à travers une discussion sur le sujet et ce que j’en retiens est que minimal API est plus rapide, plus moderne avec moins de boilerplate et donc ça m’a encouragé dans mon envie de partir dessus.</p>
<p><a href="https://www.youtube.com/watch?v=bpVN_plQm5E" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=bpVN_plQm5E</a></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pourquoi-jutilise-resultt-au-lieu-dexceptions-">Pourquoi j'utilise Result&lt;T&gt; au lieu d’Exceptions ?<a href="https://mickaelceraline.com/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api#pourquoi-jutilise-resultt-au-lieu-dexceptions-" class="hash-link" aria-label="Lien direct vers Pourquoi j'utilise Result<T> au lieu d’Exceptions ?" title="Lien direct vers Pourquoi j'utilise Result<T> au lieu d’Exceptions ?">​</a></h3>
<p>J’ai récemment regardé la vidéo de Milan Jovanovic qui introduit le pattern Result :</p>
<p><a href="https://www.youtube.com/watch?v=WCCkEe_Hy2Y&amp;t=612s" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=WCCkEe_Hy2Y&amp;t=612s</a></p>
<p>Il explique que les exceptions peuvent être coûteuses en performance. Alors, il propose un pattern intéressant pour gérer les erreurs “attendues” comme par exemple les erreurs de validation.</p>
<p>Et ainsi, on envoie des exceptions que pour les erreurs qui théoriquement ne devraient jamais arriver comment par exemple au moment de la création d’un Owner avec un paramètre non valide.
Erreur attendue :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">Result</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">Owner</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateOwnerAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> auth0Id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> lastName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> phoneNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _ownerRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetByEmailAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Result </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token generic-method function" style="color:#d73a49">Failure</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&lt;</span><span class="token generic-method generic class-name">Owner</span><span class="token generic-method generic class-name punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UserErrors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EmailAlreadyExists</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> newOwner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">Owner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">auth0Id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lastName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> phoneNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> _ownerRepository</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AddAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newOwner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Erreur qui ne devrait pas se produire car on est déjà passé par toutes les couches précédentes (y compris la validation avec FluentValidation) :</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Owner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> auth0Id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> lastName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> phoneNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsNullOrEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">auth0Id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Auth0Id cannot be null."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nameof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">auth0Id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsNullOrEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">firstName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Firstname cannot be null."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nameof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">firstName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">string</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsNullOrEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lastName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"LastName cannot be null."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nameof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">lastName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">Regexes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsMatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Email is not valid."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nameof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">Regexes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PhoneNumber</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsMatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">phoneNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"PhoneNumber is not valid."</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nameof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">phoneNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Guid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewGuid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Auth0Id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> auth0Id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FirstName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> firstName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LastName </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> lastName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PhoneNumber </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> phoneNumber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="et-fluentvalidation-dans-tout-ça-">Et FluentValidation dans tout ça ?<a href="https://mickaelceraline.com/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api#et-fluentvalidation-dans-tout-%C3%A7a-" class="hash-link" aria-label="Lien direct vers Et FluentValidation dans tout ça ?" title="Lien direct vers Et FluentValidation dans tout ça ?">​</a></h3>
<p>Je valide les entrées utilisateur dès la couche d’exposition, avec <strong>FluentValidation</strong>. C’est simple à brancher, puissant, et me permet de retourner des erreurs claires côté frontend sans mêler la validation à la logique métier. La couche domaine reste concentrée sur les règles métier, pendant que la validation des entrées est gérée directement dans la couche de présentation. Ça m'évite d’avoir des if/else ou des exceptions partout, et je peux centraliser les règles de validation dans des classes dédiées.</p>
<p>J’ai découvert FluentValidation grâce à mon frère, mais aussi via cette vidéo de Milan Jovanovic qui en fait une bonne démo :</p>
<p><a href="https://www.youtube.com/watch?v=vaDDB7BpEgQ" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=vaDDB7BpEgQ</a></p>
<p>C’est ce qui m’a convaincu de l’adopter ici.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">OwnerModelValidator</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token type-list class-name">AbstractValidator</span><span class="token type-list class-name punctuation" style="color:#393A34">&lt;</span><span class="token type-list class-name">OwnerModel</span><span class="token type-list class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">OwnerModelValidator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">RuleFor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Auth0Id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">RuleFor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FirstName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">RuleFor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LastName</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">RuleFor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Matches</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Regexes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">RuleFor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PhoneNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Matches</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Regexes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PhoneNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">OwnerEndpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">string</span><span class="token plain"> PostOwnerRoute </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/owners"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token return-type class-name keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">MapOwnerEndpoint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token plain"> </span><span class="token class-name">IEndpointRouteBuilder</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">MapPost</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PostOwnerRoute</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CreateOwner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RequireAuthorization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Owners"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">internal</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token return-type class-name">Task</span><span class="token return-type class-name punctuation" style="color:#393A34">&lt;</span><span class="token return-type class-name">IResult</span><span class="token return-type class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CreateOwner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token attribute class-name">FromBody</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token class-name">OwnerModel</span><span class="token plain"> ownerModel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IOwnerService</span><span class="token plain"> ownerService</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">IValidator</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name">OwnerModel</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> validator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> validationResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> validator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ownerModel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">validationResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IsValid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ValidationProblem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">validationResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToDictionary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> ownerService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateOwnerAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ownerModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Auth0Id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ownerModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FirstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ownerModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LastName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ownerModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ownerModel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PhoneNumber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IsSuccess</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name keyword" style="color:#00009f">var</span><span class="token plain"> newOwner </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newOwner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Error </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> UserErrors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">EmailAlreadyExists</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Conflict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Problem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token named-parameter punctuation" style="color:#393A34">statusCode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatusCodes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Status500InternalServerError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="le-résultat-">Le résultat ?<a href="https://mickaelceraline.com/blog/2025/04/14/rentcrl-domain-driven-design-minimal-api#le-r%C3%A9sultat-" class="hash-link" aria-label="Lien direct vers Le résultat ?" title="Lien direct vers Le résultat ?">​</a></h3>
<p>Au final, je pense avoir un backend propre. C’est-à-dire testable et facile à maintenir pour ajouter les autres fonctionnalités par la suite et prêt à être déployé sur Azure. En tout cas, cela reste mon point de vue de développeur avec 2 ans d’expérience.</p>
<p>📁 Code source ici : <a href="https://github.com/MickaelCRL/RentCRL" target="_blank" rel="noopener noreferrer">github.com/MickaelCRL/RentCRL</a></p>]]></content>
        <author>
            <name>Mickaël Céraline</name>
            <uri>https://github.com/mickaelcrl</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Architecture de RentCRL]]></title>
        <id>https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl</id>
        <link href="https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl"/>
        <updated>2024-03-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[1 - Introduction]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1---introduction">1 - Introduction<a href="https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl#1---introduction" class="hash-link" aria-label="Lien direct vers 1 - Introduction" title="Lien direct vers 1 - Introduction">​</a></h2>
<!-- -->
<p>Dans cet article, je vais vous présenter l'architecture de RentCRL, visant à simplifier la gestion locative en automatisant les tâches telles que la collecte des loyers et la génération des quittances pour les propriétaires.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2---choix-conceptuels">2 - Choix Conceptuels<a href="https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl#2---choix-conceptuels" class="hash-link" aria-label="Lien direct vers 2 - Choix Conceptuels" title="Lien direct vers 2 - Choix Conceptuels">​</a></h2>
<p>Pour ce projet de taille modeste, j'ai choisi de réaliser uniquement 3 diagrammes dans ma partie conception pour m'aider à le concrétiser.</p>
<p>Les voici :</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="diagramme-de-cas-dutilisation">Diagramme de cas d'utilisation<a href="https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl#diagramme-de-cas-dutilisation" class="hash-link" aria-label="Lien direct vers Diagramme de cas d'utilisation" title="Lien direct vers Diagramme de cas d'utilisation">​</a></h3>
<p><img decoding="async" loading="lazy" alt="architecture-Use-case" src="https://mickaelceraline.com/assets/images/architecture-Use-case-f21511df0a35089459e8755366814e78.jpg" width="4374" height="2553" class="img_ev3q"></p>
<p>Le diagramme de cas d'utilisation de RentCRL illustre les interactions entre les utilisateurs et le système. Les acteurs, tels que les propriétaires, les locataires et les collaborateurs, interagissent avec différentes fonctionnalités de l'application.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="diagramme-de-classe">Diagramme de classe<a href="https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl#diagramme-de-classe" class="hash-link" aria-label="Lien direct vers Diagramme de classe" title="Lien direct vers Diagramme de classe">​</a></h3>
<p><img decoding="async" loading="lazy" alt="image.jpg" src="https://mickaelceraline.com/assets/images/architecture-Class-Diagram-0208d21964c7cc2b99097764d4a955f0.jpg" width="4557" height="2691" class="img_ev3q"></p>
<p>Le diagramme de classe de RentCRL modélise la structure des entités principales et leurs relations.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="diagramme-dinfrastructure">Diagramme d'infrastructure<a href="https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl#diagramme-dinfrastructure" class="hash-link" aria-label="Lien direct vers Diagramme d'infrastructure" title="Lien direct vers Diagramme d'infrastructure">​</a></h3>
<p><img decoding="async" loading="lazy" alt="architecture-Infrastructure" src="https://mickaelceraline.com/assets/images/architecture-Infrastructure-cb317d64892034073032701fae480c22.jpg" width="1254" height="936" class="img_ev3q"></p>
<p>L'infrastructure de RentCRL se compose de quatre éléments clés :</p>
<ul>
<li>Web : L'application web contenant les fichiers JavaScript, HTML, CSS.</li>
<li>Backend : L'application backend renfermant les fichiers C# / .Net et responsable du fonctionnement logique du système.</li>
<li>DataBase 'CosmosDB' : Le stockage sécurisé des données nécessaires au bon fonctionnement de RentCRL.</li>
<li>Auth0 : L'authentification et la gestion des mots de passe des utilisateurs.</li>
</ul>
<p>J'ai choisi ces trois diagrammes spécifiques pour leur pertinence même dans le cadre d'un projet modeste comme RentCRL. Ensemble, ils fournissent une perspective exhaustive des interactions utilisateur, de la structure des données et de l'infrastructure technique nécessaires pour le développement du système.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3---conclusion">3 - CONCLUSION<a href="https://mickaelceraline.com/blog/2024/03/07/architecture-rentcrl#3---conclusion" class="hash-link" aria-label="Lien direct vers 3 - CONCLUSION" title="Lien direct vers 3 - CONCLUSION">​</a></h2>
<p>Ces diagrammes constituent une base pour m'aider à la réalisation concrète de RentCRL. Dans le prochain article, je commencerai à montrer comment créer la solution.</p>]]></content>
        <author>
            <name>Mickaël Céraline</name>
            <uri>https://github.com/mickaelcrl</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Présentation de RentCRL]]></title>
        <id>https://mickaelceraline.com/blog/2023/09/30/presentation-rentcrl</id>
        <link href="https://mickaelceraline.com/blog/2023/09/30/presentation-rentcrl"/>
        <updated>2023-09-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[1 - Objectif]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1---objectif">1 - Objectif<a href="https://mickaelceraline.com/blog/2023/09/30/presentation-rentcrl#1---objectif" class="hash-link" aria-label="Lien direct vers 1 - Objectif" title="Lien direct vers 1 - Objectif">​</a></h2>
<!-- -->
<p>Je suis heureux de vous présenter mon nouveau projet, RentCRL. Dans les prochains jours, je travaillerai activement sur ce projet et partagerai avec vous les détails de son développement à travers une série d'articles.</p>
<p>RentCRL vise à simplifier la gestion des biens immobiliers pour les propriétaires. Il s'agit d'une application web qui permettra aux propriétaires de prélever les loyers de leurs locataires et d'envoyer les quittances de manière entièrement automatisée.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2---inspiration">2 - Inspiration<a href="https://mickaelceraline.com/blog/2023/09/30/presentation-rentcrl#2---inspiration" class="hash-link" aria-label="Lien direct vers 2 - Inspiration" title="Lien direct vers 2 - Inspiration">​</a></h2>
<p>L'idée derrière RentCRL découle d'une expérience personnelle au sein de notre entreprise familiale spécialisée dans l'immobilier. Nous avons constaté la nécessité de simplifier le processus de gestion des loyers et des quittances, actuellement géré manuellement avec l'aide de l'outil Rentila.</p>
<p>Mes motivations pour ce projet sont doubles :</p>
<ol><li>Simplifier et automatiser une tâche fastidieuse tout en mettant en pratique mes compétences en développement web.</li><li>Accroître ma visibilité en tant que développeur web pour décrocher des contrats de développement intéressants.</li></ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3---méthodologie">3 - Méthodologie<a href="https://mickaelceraline.com/blog/2023/09/30/presentation-rentcrl#3---m%C3%A9thodologie" class="hash-link" aria-label="Lien direct vers 3 - Méthodologie" title="Lien direct vers 3 - Méthodologie">​</a></h2>
<p>Le développement de RentCRL fera appel aux technologies suivantes :</p>
<ul><li><p>Front-end :</p><ul><li>JavaScript</li><li>HTML5</li><li>Angular</li><li>CSS3</li></ul></li><li><p>Back-end :</p><ul><li>C# / .NET</li></ul></li><li><p>Base de données :</p><ul><li>Azure CosmosDB</li></ul></li></ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4---à-venir">4 - À venir<a href="https://mickaelceraline.com/blog/2023/09/30/presentation-rentcrl#4---%C3%A0-venir" class="hash-link" aria-label="Lien direct vers 4 - À venir" title="Lien direct vers 4 - À venir">​</a></h2>
<p>Je commencerai par la phase de planification et de conception. Prochainement, je vous présenterai en détail l'architecture de RentCRL.</p>]]></content>
        <author>
            <name>Mickaël Céraline</name>
            <uri>https://github.com/mickaelcrl</uri>
        </author>
    </entry>
</feed>